<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>הדמיית DNA עם זום וטעינה דינמית + Web Worker</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    direction: rtl;
    user-select: none;
  }
  #container {
    width: 100vw; height: 100vh;
    display: flex; flex-direction: column;
    align-items: center; justify-content: flex-start;
    padding: 15px;
    box-sizing: border-box;
  }
  #controls {
    margin-bottom: 10px;
  }
  label, input, button {
    font-size: 16px;
    margin: 5px;
  }
  #canvasContainer {
    position: relative;
    background: #222;
    border: 2px solid #0fa;
    border-radius: 8px;
    width: 90vw;
    height: 500px;
    overflow: hidden;
  }
  canvas {
    display: block;
    background: #222;
    margin: auto;
  }
  #infoBox {
    margin-top: 10px;
    width: 90vw;
    font-size: 18px;
    background: #000a;
    padding: 8px;
    border-radius: 5px;
  }
  input[type=range] {
    vertical-align: middle;
  }
</style>
</head>
<body>

<div id="container">
  <div id="controls">
    <button id="btnPrev">⬅ קודם</button>
    <button id="btnNext">הבא ➡</button>
    <button id="btnStart">▶ הפעל</button>
    <button id="btnPause">⏸ עצור</button>
    <button id="btnReset">⏮ אפס</button>
    <label>מהירות:
      <input type="range" id="speedRange" min="1" max="60" value="10" />
    </label>
    <label>זום (בסיסים):
      <input type="range" id="zoomRange" min="10" max="1000" value="100" step="10" />
    </label>
    <label>קפוץ למיקום:
      <input type="number" id="posInput" min="0" max="3000000000" value="0" style="width:120px" />
      <button id="btnJump">קפוץ</button>
    </label>
  </div>

  <div id="canvasContainer">
    <canvas id="dnaCanvas" width="850" height="480"></canvas>
  </div>
  <div id="infoBox">מיקום: 0 / 3,000,000,000<br>בסיס נוכחי: ---<br>מתילציה: ---</div>
</div>

<script>
// הגדרות
const GENOME_LENGTH = 3_000_000_000;

function baseAt(pos) {
  const bases = ['A','T','C','G'];
  const val = (Math.sin(pos * 12.989*

