<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>הדמיית DNA עם Web Worker</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    direction: rtl;
    user-select: none;
  }
  #container {
    width: 100vw; height: 100vh;
    display: flex; flex-direction: column;
    align-items: center; justify-content: flex-start;
    padding: 15px;
    box-sizing: border-box;
  }
  #controls {
    margin-bottom: 10px;
  }
  label, input, button {
    font-size: 16px;
    margin: 5px;
  }
  #canvasContainer {
    position: relative;
    background: #222;
    border: 2px solid #0fa;
    border-radius: 8px;
    width: 90vw;
    height: 500px;
    overflow: hidden;
  }
  canvas {
    display: block;
    background: #222;
    margin: auto;
  }
  #infoBox {
    margin-top: 10px;
    width: 90vw;
    font-size: 18px;
    background: #000a;
    padding: 8px;
    border-radius: 5px;
  }
  input[type=range] {
    vertical-align: middle;
  }
</style>
</head>
<body>

<div id="container">
  <div id="controls">
    <button id="btnPrev">⬅ קודם</button>
    <button id="btnNext">הבא ➡</button>
    <button id="btnStart">▶ הפעל</button>
    <button id="btnPause">⏸ עצור</button>
    <button id="btnReset">⏮ אפס</button>
    <label>מהירות:
      <input type="range" id="speedRange" min="1" max="60" value="10" />
    </label>
    <label>זום (בסיסים):
      <input type="range" id="zoomRange" min="10" max="1000" value="100" step="10" />
    </label>
    <label>קפוץ למיקום:
      <input type="number" id="posInput" min="0" max="1000" value="0" style="width:120px" />
      <button id="btnJump">קפוץ</button>
    </label>
  </div>

  <div id="canvasContainer">
    <canvas id="dnaCanvas" width="850" height="480"></canvas>
  </div>

  <div id="infoBox">
    מיקום: 0 / 1,000<br>
    בסיס נוכחי: ---<br>
    מתילציה: ---
  </div>
</div>

<script>
  const canvas = document.getElementById('dnaCanvas');
  const ctx = canvas.getContext('2d');

  const bases = ['A', 'T', 'C', 'G'];
  const genomeLength = 1000;  // קטן לדוגמה
  let position = 0;
  let zoom = 100;
  let speed = 10;
  let running = false;

  function baseAt(pos) {
    return bases[pos % bases.length];
  }

  function complement(base) {
    switch(base) {
      case 'A': return 'T';
      case 'T': return 'A';
      case 'C': return 'G';
      case 'G': return 'C';
      default: return '?';
    }
  }

  function drawDNA(pos, zoom) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.font = '14px monospace';
    ctx.fillStyle = '#0fa';

    const centerY = canvas.height / 2;
    const baseSpacing = 10;

    for(let i = 0; i < zoom; i++) {
      const idx = pos + i;
      if(idx >= genomeLength) break;
      const base = baseAt(idx);

      const x = 50 + i * baseSpacing;
      const y1 = centerY - 20 * Math.sin(i * 0.3);
      const y2 = centerY + 20 * Math.sin(i * 0.3);

      ctx.fillText(base, x, y1);
      ctx.fillText(complement(base), x, y2);

      ctx.strokeStyle = '#0fa';
      ctx.beginPath();
      ctx.moveTo(x, y1 + 5);
      ctx.lineTo(x, y2 - 5);
      ctx.stroke();
    }
  }

  function updateInfo() {
    document.getElementById('infoBox').innerHTML = 
      `מיקום: ${position} / ${genomeLength}<br>` +
      `בסיס נוכחי: ${baseAt(position)}<br>` +
      `מתילציה: ---`;
  }

  function stepNext() {
    if(position < genomeLength - 1) position++;
    drawDNA(position, zoom);
    updateInfo();
  }

  function stepPrev() {
    if(position > 0) position--;
    drawDNA(position, zoom);
    updateInfo();
  }

  let intervalId;

  function start() {
    if(running) return;
    running = true;
    intervalId = setInterval(() => {
      stepNext();
      if(position >= genomeLength - zoom) stop();
    }, 1000 / speed);
  }

  function stop() {
    running = false;
    clearInterval(intervalId);
  }

  function reset() {
    stop();
    position = 0;
    drawDNA(position, zoom);
    updateInfo();
  }

  document.getElementById('btnNext').addEventListener('click', stepNext);
  document.getElementById('btnPrev').addEventListener('click', stepPrev);
  document.getElementById('btnStart').addEventListener('click', start);
  document.getElementById('btnPause').addEventListener('click', stop);
  document.getElementById('btnReset').addEventListener('click', reset);

  document.getElementById('speedRange').addEventListener('input', e => {
    speed = e.target.value;
    if(running) {
      stop();
      start();
    }
  });

  document.getElementById('zoomRange').addEventListener('input', e => {
    zoom = parseInt(e.target.value);
    drawDNA(position, zoom);
  });

  document.getElementById('btnJump').addEventListener('click', () => {
    const val = parseInt(document.getElementById('posInput').value);
    if(val >= 0 && val < genomeLength) {
      position = val;
      drawDNA(position, zoom);
      updateInfo();
    }
  });

  reset();
</script>

</body>
</html>
